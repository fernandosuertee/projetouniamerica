<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>CadEmpresa</title>

	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/estilo.css">

	<!--Verifica CNPJ se é valido-->
	<script>
		function validarCNPJ(cnpj) {
    cnpj = cnpj.replace(/[^\d]+/g, ''); // Remove caracteres não numéricos

    if (cnpj.length !== 14) {
        alert("CNPJ inválido. Deve conter 14 dígitos.");
        return;
    }

    var tamanho = cnpj.length - 2;
    var numeros = cnpj.substring(0, tamanho);
    var digitos = cnpj.substring(tamanho);
    var soma = 0;
    var pos = tamanho - 7;

    for (var i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2) pos = 9;
    }

    var resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);

    if (resultado != digitos.charAt(0)) {
        alert("CNPJ inválido. Dígitos verificadores não conferem.");
        return;
    }

    tamanho = tamanho + 1;
    numeros = cnpj.substring(0, tamanho);
    soma = 0;
    pos = tamanho - 7;

    for (var i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2) pos = 9;
    }

    resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);

		if (resultado != digitos.charAt(1)) {
			alert("CNPJ inválido. Dígitos verificadores não conferem.");
			return;
		}
		alert("CNPJ válido.");
	}
	</script>

	<!-- formatacao pontos e barras cnpj -->
	<script>
		function formatarCNPJ(cnpj) {
			// Remove caracteres não numéricos
			cnpj = cnpj.replace(/[^\d]/g, '');

			// Adiciona os pontos e barras
			cnpj = cnpj.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
		}
		function formatarCNPJ(cnpj) {
			// Remove caracteres não numéricos
			cnpj = cnpj.replace(/[^\d]/g, '');

			// Adiciona os pontos e barras
			cnpj = cnpj.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');

			return cnpj;
		}

		// Função para atualizar o campo CNPJ à medida que o usuário digita
		function autoFormatarCNPJ(input) {
			var cnpj = input.value;
			var cnpjFormatado = formatarCNPJ(cnpj);
			input.value = cnpjFormatado;
		}

	</script>

	<!-- API preenchimento endereco pelo CEP -->
	<script>
	// Adicione um evento de escuta ao campo de CEP
	document.getElementById("inputCEP").addEventListener("blur", function() {
		var cep = this.value.replace(/\D/g, ''); // Remove caracteres não numéricos

		// Verifica se o CEP possui o formato correto
		if (cep.length === 8) {
			// Faz uma solicitação à API ViaCEP
			var url = `https://viacep.com.br/ws/${cep}/json/`;
			
			fetch(url)
				.then(response => response.json())
				.then(data => {
					// Preenche os campos com os dados obtidos da API
					document.getElementById("inputBairro").value = data.bairro;
					document.getElementById("inputAddress").value = data.logradouro;
					document.getElementById("inputEstado").value = data.uf;
					// Outros campos que você queira preencher
				})
				.catch(error => {
					console.error("Erro ao buscar dados do CEP: " + error);
				});
				}
		} 	);

		function limpa_formulário_cep() {
		//Limpa valores do formulário de cep.
		document.getElementById('rua').value=("");
		document.getElementById('bairro').value=("");
		document.getElementById('cidade').value=("");
		document.getElementById('uf').value=("");
		}

		function meu_callback(conteudo) {
			if (!("erro" in conteudo)) {
				//Atualiza os campos com os valores.
				document.getElementById('rua').value=(conteudo.logradouro);
				document.getElementById('bairro').value=(conteudo.bairro);
				document.getElementById('cidade').value=(conteudo.localidade);
				document.getElementById('uf').value=(conteudo.uf);
			} //end if.
			else {
				//CEP não Encontrado.
				limpa_formulário_cep();
				alert("CEP não encontrado.");
			}
		}

		function pesquisacep(valor) {

		//Nova variável "cep" somente com dígitos.
		var cep = valor.replace(/\D/g, '');

		//Verifica se campo cep possui valor informado.
		if (cep != "") {

			//Expressão regular para validar o CEP.
			var validacep = /^[0-9]{8}$/;

			//Valida o formato do CEP.
			if(validacep.test(cep)) {

				//Preenche os campos com "..." enquanto consulta webservice.
				document.getElementById('rua').value="...";
				document.getElementById('bairro').value="...";
				document.getElementById('cidade').value="...";
				document.getElementById('uf').value="...";

				//Cria um elemento javascript.
				var script = document.createElement('script');

				//Sincroniza com o callback.
				script.src = 'https://viacep.com.br/ws/'+ cep + '/json/?callback=meu_callback';

				//Insere script no documento e carrega o conteúdo.
				document.body.appendChild(script);

			} //end if.
				else {
					//cep é inválido.
					limpa_formulário_cep();
					alert("Formato de CEP inválido.");
				}
			} //end if.
				else {
					//cep sem valor, limpa formulário.
					limpa_formulário_cep();
			}
		}
	</script>

	<!-- estilo css interno -->
	<style>
		.body{
			background-color: #00e88f
		}

	</style>

</head>
<body>
	<section>
		<nav class="navbar navbar-dark bg-dark">
		  <a class="navbar-brand mr-auto" href="../home.html">
			<img src="img/logoDescohorizontal.png" style="padding-left: 10%;" width="300" height="45" >
		  </a>
		</nav>
	</section>
	<section class="body">
		<div class="row col-md-12">
			<div class="col-md-4"></div>
			<div class="col-md-4 cadastro">
				<form method="get" action="CadDemanda.html">
					<br>
					<h3>Etapa 1 - Cadastro da Empresa</h3>
					<div class="form-row">
					<div class="form-group col-md">
						<br>
						<label for="inputCNPJ">CNPJ:</label>
						<input name="cnpj" type="text" class="form-control" id="inputCNPJ" size="14" maxlength="14" placeholder="99.999.999/9999-99" onblur="validarCNPJ(this.value);" oninput="autoFormatarCNPJ(this);" required>
					</div>
					<div class="form-group col-md">
						<br>
						<label for="inputNomeFantasia">Nome Fantasia:</label>
						<input type="text" class="form-control" id="inputNomeFantasia" placeholder="Digite o Nome Fantasia" equired oninput="this.value = this.value.replace(/[^A-Za-z\s]/g, '');">>
					</div>
					<br>
					<div class="form-group col-md">
						<label for="inputRazaoSocial">Razão Social:</label>
						<input type="text" class="form-control" id="inputRazaoSocial" placeholder="Digite a Razão Social" equired oninput="this.value = this.value.replace(/[^A-Za-z\s]/g, '');">>
					</div>
					<br>
					<div class="form-group col-md-6">
						<label>CEP:
						<input name="cep" type="text" class="form-control" id="cep" value="" size="10" maxlength="8" onblur="pesquisacep(this.value);" placeholder="XXXXX-XXX" required/>
						</label>	
					</div>
					<br>
					<div class="form-group">
						<label>Endereço:
						<input name="rua" type="text" class="form-control" id="rua" size="60" placeholder="Rua, nº 0" readonly /></label>  	
					</div>
					<br>
					<div class="form-group">
						<label for="inputAddress2">Complemento:</label>
						<input type="text" class="form-control" id="inputAddress2" placeholder="Apartamento, hotel, casa, etc." required>
					</div>
					<br>
					<div class="form-group">
						<label>Bairro:
							<input name="bairro" type="text" class="form-control" id="bairro" size="40" placeholder="Vila Yolanda" readonly /></label>
					</div>
					<br>					  
					<div class="form-row">
					<div class="form-group col-md-6">
						<label>Cidade:
							<input name="cidade" type="text" class="form-control" id="cidade" size="40" placeholder="Rio de Janeiro" readonly /></label>
					</div>
					<br>
					<div class="form-group col-md-4">
						<label>Estado:
							<input name="uf" type="text" class="form-control" id="uf" size="2" placeholder="RJ" readonly/>
						</label>
					</div>
					<br>
					<div class="form-group col-md-8">
						<label for="inputPais">País de Origem:</label>
						<input type="text" class="form-control" id="inputPais" placeholder="EUA" required>
					</div>
					<br>
					<div class="form-group">
					  	<label for="inputEmail">Email:</label>
					  	<input type="email" class="form-control" id="inputEmail" placeholder="xxxxxxxxxxx@xxxx.com" required>
					</div>
					<div style="">
						<label>
							<input name="ibge" type="hidden" id="ibge" size="8" /></label>
					</div>
					<br><br>
					<div class="d-grid gap-2 col-6 mx-auto">
						<button type="submit" class="btn btn-primary" > Finalizar Cadastro </button>
					</div>
					<br>
				</form>
			</div>
		</div>
	</section>

<!-- chamada do JS -->
<script type="text/javascript" src="js/CadDemanda.js"></script>
<script type="text/javascript" src="views/js/bootrstrap.js"></script>
</body>
</html>

